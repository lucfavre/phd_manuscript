% Chapter 1

\chapter{NEPTUNE\_CFD Code} % Chapter title

\label{chap:ncfd} % For referencing the chapter elsewhere, use \autoref{ch:introduction} 

%----------------------------------------------------------------------------------------

\minitoc


\section{Introduction}

The NEPTUNE\_CFD project (started in 2001) is a reasearch program coordinated by four entities : EDF, CEA, IRSN and Framatome. The initial goals of the project were related to nuclear safety by developing a thermal-hydraulics simulation tool to :

\begin{itemize}
\item Predict the Boiling Crisis in PWR cores ;
\item Study the Loss Of Coolant Accident (LOCA) to predict fuel rod cladding temperature.
\end{itemize}

The code consists of a local three-dimensional modeling based on a two-fluid one pressure approach combined with mass, momentum and energy conservation equations for each phase\cite{guelfi2007}. 

 is an eulerian multiphase CFD solver co-developed 

\npar
%The NEPTUNE\_CFD solver can handle several types of multiphase flows, \eg dispersed vapor-liquid flow of a same component, mixed gas-liquid-solid particles flow of different components, or multiple forms of a single component (dispersed vapor/continuous liquid, dispersed liquid/continuous vapor, continuous liquid/continuous vapor, etc.).
The constitutive equations are solved using a pressure correction, and is based on a finite-volume discretization along with a collocated arrangement of the variables. Moreover, NEPTUNE\_CFD allows the use of all type of meshes (hexahedra, tetrahedra, pyramids, etc.), even non-conforming ones, thanks to its face-based data structure. Finally, the code is well-suited for parallel computing, widening its computing capacity to very large meshes.

\npar

The simulations presented in this thesis have all been conducted using the NEPTUNE\_CFD 7.0 modeling framework for dispersed bubbly flows. In the next sections, we will detail the constitutive equations and closures laws of the code for the simulation of boiling bubbly flows.


\section{Governing Equations for Turbulent Boiling Bubbly Flows}

To simulate two-phase dispersed boiling flows, NEPTUNE\_CFD solves the ensemble-averaged equations of mass conservation, momentum balance and energy conservation for each phase : 
%As a reminder, the ensemble-averaging of a physical quantity $F_{k}$ for any phase $k$ in a multiphase flows is defined as:



\subsection{Mass Conservation :}
\begin{equation}
	\label{eq:mass}
%MASS
	\dtime{\alpha_{k}\rho_{k}} + \divg{\alpha_{k}\rho_{k} \vect{U_{k}}} = \orangemath{\Gamma_{k}}
\end{equation}

Where $\alpha_{k}$, $\rho_{k}$, $\vect{U_{k}}$ are the time fraction, average density and velocity of phase $k$ ; $\Gamma_{k}=\Gamma_{k,i}+\Gamma_{k,w}$ the interfacial mass transfer term per unit of volume and time splitted between bulk and wall contribution.
Subscripts $k= L$ or $V$ denotes the liquid or vapor phase, $i$ the interfacial quantities and $w$ the wall contribution.

\subsection{Momentum Balance :}

\begin{equation}
	\label{eq:momentum}
%MOMENTUM
	\dtime{\alpha_{k}\rho_{k}\vect{U_{k}}} + \vecdivg{\alpha_{k}\rho_{k} \vect{U_{k}}\otimes \vect{U_{k}}} = -\alpha_{k}\grad{P} + \orangemath{\vect{F_{k,i}}} + \orangemath{\Gamma_{k}}\vect{U_{k,i}} + \alpha_{k}\rho_{k}\vect{g} + \vecdivg{\alpha_{k} \parth{ \tens{\tau_{k,m}} + \orangemath{\tens{\tau_{k,T}}} }}
\end{equation}

Where $P$ is the pressure, $\vect{g}$ the gravity, $\vect{F_{k,i}}$ the interfacial forces accounting for momentum transfer between phases per unit of volume and time, $\vect{U_{k,i}}$ the interfacial velocity, $\tens{\tau_{k,m}}$ and $\tens{\tau_{k,T}}$ respectively the viscous and turbulent (or Reynolds) stress tensor. Subscript $m$ and $T$ respectively denote the molecular (or laminar) and turbulent terms.

\subsection{Energy Conservation :}

\begin{equation}
	\label{eq:energy}
\begin{aligned}
%ENERGY
	\dtime{\alpha_{k}\rho_{k} H_{k}} + \divg{\alpha_{k}\rho_{k} H_{k}\vect{U_{k}}} =& \dtime{\alpha_{k}P} + \orangemath{\Gamma_{k}}H_{k,i}+\orangemath{\vect{F_{k,i}}}\cdot \vect{U_{k}} + \orangemath{Q_{k,I}} + \divg{\alpha_{k}\parth{ \tens{\tau_{k}} + \orangemath{\tens{\tau_{k,T}}} }\cdot \vect{U_{k}}}\\
	& + \divg{\alpha_{k} \parth{-\parth{ \lambda_{k,m}+\orangemath{\lambda_{k,T}}}\grad{T_{k}}}} + \alpha_{k}\rho_{k}\vect{g}\cdot \vect{U_{k}} + \orangemath{Q_{k,w}}
\end{aligned}
\end{equation}

Where $H_{k}=e_{k}+\frac{U_{k}^{2}}{2}+\frac{P}{\rho_{k}}=h_{k}+\frac{U_{k}^{2}}{2}$ is the total enthalpy of phase $k$, $H_{k,i}$ the interfacial-averaged enthalpy, $Q_{k,i}$ the interfacial heat flux per unit of volume and time, $\lambda_{k,m}$ and $\lambda_{k,T}$ respectively being the laminar and turbulent thermal conductivity, $T_{k}$ the temperature, $Q_{k,w}$ the heat flux from the wall to phase $k$ per unit of volume and time.

\npar

However, this ensemble-average approach requires a given number of closure laws since this mathematical operation removes most of the information about smaller scales physics such as interfacial exchanges between phases or wall-fluid interaction. Terms for which this modeling effort is needed are colored in orange in equations \ref{eq:mass}, \ref{eq:momentum} and \ref{eq:energy}. The chosen expressions for those terms are detailed in subsections \ref{subsec:int_transfers}, \ref{subsec:turbulence} and \ref{subsec:HFP}.

\section{Interfacial transfers closure laws}
\label{sec:int_transfers}

The interfacial transfers of mass, momentum and energy are respectively noted in equations \ref{eq:mass}, \ref{eq:momentum} and \ref{eq:energy} : $\Gamma_{k}$, $\vect{F_{k,i}}$ and $Q_{k,i}$.

\subsection{Heat and mass transfers :}
\label{subsec:ncfd_interf_mass}


The mass transfer term, can be written as : $\Gamma_{L,i} + \Gamma_{G,i} = 0$, $\Gamma_{L,w} + \Gamma_{G,w} = 0$ with $\Gamma_{G,w} \geq 0$ in the case of boiling flows. This finally gives $\Gamma_{L}=-\Gamma_{G}$.

The interfacial heat flux $Q_{k,i}$ can be rewritten in terms of interfacial area concentration $a_{i}$ : $Q_{k,i}=q''_{k,i}a_{i}$. Neglecting the mechanical contribution compared to the thermal terms, the energy jump condition can then be expressed as :

\begin{equation}
\label{eq:energy_jump}
\sum_{k=L,G}\parth{\Gamma_{k,i}h_{k,i} + q''_{k,i}a_{i}}=0
\end{equation}

The estimation of $h_{k,i}$ is not straightforward since it can either be supposed to be the saturation enthalpy of phase $k$ at the system pressure (H1) or $h_{k,i}$ can be identified to the phase-averaged enthalpy (H2). In NEPTUNE\_CFD, the assumption H2 is chosen, thus giving the bulk condensation rate :

\begin{equation}
\label{eq:condensation_rate}
\Gamma_{L,i}=\frac{a_{i}\parth{q''_{L,i}+q''_{G,i}}}{h_{G,sat}-h_{L,sat}}
\end{equation}
The interfacial heat flux densities $q''_{k,i}$ and interfacial area concentration $a_{i}$ are expressed as $q''_{k,i}=C_{k,i}\parth{T_{sat}(P)-T_{k}}$ and $a_{i}=6 \alpha_{G}/d_{G}$, $d_{G}$ being the gas phase Sauter mean bubble diameter. The interfacial area is computed using the transport equation of \textsc{Ruyer} \& \textsc{Seiler}\cite{ruyer2009}.

For subcooled liquid, the following heat transfer coefficient is used \cite{manon2000}:

\begin{equation}
\label{eq:subcooled_HT}
C_{L,i}=\frac{Nu_{L}\lambda_{L}}{d_{G}} \text{ and } Nu_{L}=2+0.6Re^{1/2}Pr_{L}^{1/3}
\end{equation}

Where $Re$ is the bubble Reynolds number $Re=\norm{\vect{U_{G}}-\vect{U_{L}}}d_{G}/\nu_{L}$ and $Pr_{L}$ the liquid Prandtl number $Pr_{L}=\nu_{L}/\eta_{L}$ with $\nu_{L}$ and $\eta_{L}$ respectively being the liquid kinematic viscosity and thermal diffusivity.

On the other hand, if the liquid is overheated, the maximum of three heat transfer coefficients accounting for different heat tranfer mechanisms is taken \cite{berne1983}:

\begin{equation}
\label{eq:superheated_HT}
C_{L,i}=\max{C_{L,i,1} ; C_{L,i,2} ; C_{L,i,3}}
\end{equation}

With $C_{L,i,n}=\lambda_{L}Nu_{L,n}/d_{G}$ and :

\begin{equation}
\label{eq:nusselt}
Nu_{1}=\sqrt{\frac{4}{\pi}Pe}\text { ; } Nu_{2}=2 \text{ ; } Nu_{3}=\frac{12}{\pi} Ja
\end{equation}


where $Pe=\norm{ \vect{U_{G}}-\vect{U_{L}} }d_{G}/\eta_{L}$ is the Peclet number and $Ja=\rho_{L}c_{p,L}\bars{T_{sat}-T_{L}}/\parth{\rho_{g} h_{lg}}$ the Jakob number, with $h_{lg}$ the latent heat of vaporization. Those three Nusselt numbers respectively correspond to convection heat transfer, stationnary conduction and transient conduction.


For the gas phase, a simple law that ensures that the vapor temperature remains close to the saturation temperature is used (which is expected for small bubbles, \eg in a PWR) :

\begin{equation}
\label{eq:gas_relaxation}
C_{G,i}a_{i}=\frac{\alpha_{G}\rho_{v}c_{p,G}}{t_{c}}
\end{equation}

where $c_{p,G}$ is the gas heat capacity at constant pressure, and $t_{c}$ a characteristic (relaxation) time given by the user (default value being $t_{c}=0.01\text{s}$) .

\subsection{Interfacial Forces}
\label{subsec:ncfd_interf_qdm}

The interfacial momentum transfer (excluding transfer associated to transfer of mass $\Gamma_{k}$) is assumed to be composed of 4 different forces being the, drag $D$, the added mass $AM$, the lift $L$ and the turbulent dispersion $TD$ :

\begin{equation}
\label{eq:force_balance}
\vect{F_{k,i}}=\vect{F_{k,D}} + \vect{F_{k,AM}} +\vect{F_{k,L}} +\vect{F_{k,TD}}
\end{equation}

The turbulent dispersion force $\vect{F_{k,TD}}$ originates from the averaging operation conducted on the three other forces' expressions, detailed in equations \ref{eq:drag}, \ref{eq:added_mass}, \ref{eq:lift} and \ref{eq:turb_disp}.


\begin{equation}
\label{eq:drag}
\vect{F_{G,D}}=-\vect{F_{L,D}}=-\frac{1}{8}a_{i}\rho_{L}C_{D}\norm{ \vect{U_{G}}-\vect{U_{L}} }\parth{\vect{U_{G}}-\vect{U_{L}} }
\end{equation}

\begin{equation}
C_{D} = \frac{2}{3}D_{b}\sqrt{\dfrac{g\parth{\rho_{L}-\rho_{V}}}{\sigma}}\parth{ \frac{1 + 17.67~f\parth{\alpha}^{1.67}}{18.67f\parth{\alpha}} }, \ f\parth{\alpha} = \parth{1-\alpha}^{1.5}\ \text{for distorted bubbles.}
\end{equation}

\begin{equation}
C_{D} = \frac{8}{3} \parth{1-\alpha}^{2}\ \text{for churn-turbulent regime.}
\end{equation}

\begin{align}
\vect{F_{G,AM}}=-\vect{F_{L,AM}}=&-C_{AM} \frac{1+2\alpha_{G}}{1-\alpha_{G}}\alpha_{G}\rho_{L}\\
&\times \crocht{ \parth{\dtime{\vect{U_{G}}}+\vecgrad{\vect{U_{G}}}\cdot \vect{U_{G}} } - \parth{\dtime{\vect{U_{L}}}+\vecgrad{\vect{U_{L}}}\cdot \vect{U_{L}} } }
\label{eq:added_mass}
\end{align}
with $C_{AM}=\dfrac{1}{2}$.

\begin{equation}
\label{eq:lift}
\vect{F_{G,L}}=-\vect{F_{L,L}}=-C_{L}\alpha_{G}\rho_{L}\parth{\vect{U_{G}}-\vect{U_{L}} }\wedge \parth{\rot{\vect{U_{L}}} }
\end{equation}

\begin{equation}
C_{L} = \begin{cases}
    \min{0.288\tanh{0.121\Re_{b}}\ ;\ 0.00105 \Eo_{H}^{3}-0.0159\Eo_{H}^{2} - 0.0204\Eo_{H}+0.474}, & \text{if}\ \Eo_{H}<4\\
   0.00105 \Eo_{H}^{3}-0.0159\Eo_{H}^{2} - 0.0204\Eo_{H}+0.474, & \text{if}\ 4\leq \Eo_{H} \leq 10\\
   -0.27, & \text{if}\ \Eo_{H}>10
  \end{cases}
\end{equation}



\begin{equation}
\label{eq:turb_disp}
\vect{F_{G,TD}}=-\vect{F_{L,TD}}=-\frac{2}{3}\alpha_{L}\alpha_{G}C_{TD}\grad{\alpha_{G}}
\end{equation}

with $C_{D}$, $C_{AM}$, $C_{L}$ and $C_{TD}$ the associated forces coefficients, respectively taken from \textsc{Ishii}\cite{ishii1967}, \textsc{Zuber}\cite{zuber1964}, \textsc{Tomiyama}\cite{tomiyama2002} and the Generalized Turbulent Dispersion model (GTD) from \textsc{Lavieville} \etal \cite{lavieville2017}.

\section{Turbulence Modeling}
\label{subsec:turbulence}

\begin{equation}
\dtime{R_{ij}} + U_{k}
\end{equation}

\begin{equation}
\dtime{\tens{R}} + \vect{U_{k}}\cdot \grad{R_{ij}} = 
\end{equation}

For bubbly flow simulations, only liquid phase turbulence is taken into account. The prescribed model is the Reynolds Stress Model (RSM) $R_{ij}-\varepsilon~SSG$ from \textsc{Speziale}, \textsc{Sarkar} and \textsc{Gatski}\cite{speziale1991} adapted to two-phase boiling flows by \textsc{Mimouni} \etal\cite{mimouni2011}.

\begin{equation}
\dtime{R_{ij}} + U_{k}\dpartial{R_{ij}}{x_{k}} = - R_{ik} \dpartial{U_{j}}{x_{k}}
\end{equation}


\section{Wall Boiling Model}
\label{sec:ncfd_HFP}

The modeling of the heterogeneous boiling phenomenon at the wall is based on a Heat Flux Partioning (HFP) model, inspired by \textsc{Kurul} \& \textsc{Podowski} original work\cite{kurul1990} who divided the wall heat flux density $\phi_{w}$ in three terms  :

\begin{itemize}
\item A single phase convective heat flux $\phi_{c,L}$ heating the liquid through the fraction of the wall area unaffected by the vapor bubbles
\item A vaporization heat flux $\phi_{e}$ which accounts for the generation of vapor through heterogeneous nucleation
\item A quenching heat flux $\phi_{q}$ to represent the thermal impact of bubbles departing from the wall and being replaced by cool liquid
\end{itemize}

A fourth flux is added to this HFP in NEPTUNE\_CFD, following \textsc{Mimouni} \etal\cite{mimouni2016} who consider a convective heat flux heating the vapour $\phi_{c,G}$ when the wall area is covered by a dense accumulation of bubbles.

The model thus gives Equation \ref{eq:HFP} :

\begin{equation}
\label{eq:HFP}
\phi_{w}=\phi_{c,L}+\phi_{e}+\phi_{q}+\phi_{c,G}
\end{equation}

The convective heat fluxes are expressed as $\phi_{c,k}=A_{k}h_{k,log}\parth{T_{w}-T_{k}}$ with :

\begin{equation} 
h_{k,log}=\rho_{k}c_{p,k}{u^{*}}/{T_{L}^{+}}
\label{eq:ncfd_hfc}
\end{equation}
where $A_{k}$ the fraction of the wall area facing phase $k$, $T_{w}$ the wall temperature and $h_{k,log}$ the wall logarithmic convective heat transfer coefficient to phase $k$ based on the wall functions for friction velocity $u^{*}$ and non-dimensional liquid temperature $T_{L}^{+}$ described in \ref{subsec:wall_func}.

The vaporization heat flux is computed following:


\begin{equation}
\phi_{e}=N_{sit}f\rho_{G}h_{lg}{\pi d_{d}^{2}}/{6}
\label{eq:phie_NCFD}
\end{equation}with $N_{sit}$ the nucleation site density modeled as \cite{lemmert1977}

\begin{equation}
N_{sit}=\crocht{210\parth{T_{w}-T_{sat}} }^{1.8}
\label{eq:nsit_NCFD}
\end{equation}

\begin{itemize}

\item $f$ the bubble detachment frequency expressed as \cite{cole1960} : $f=\sqrt{\frac{4}{3}\frac{g\bars{\rho_{v}-\rho_{l}} }{\rho_{l}d_{d}}}$
\item $d_{d}$ the bubble detachment diameter given by Unal correlation\cite{unal1976} corrected by Bor\'ee \etal[ref] (Equation \ref{eq:unal})
\end{itemize}

\begin{equation}
\label{eq:unal}
d_{d}=2.42\times 10^{-5} P^{0.709} \frac{a}{\sqrt{b\varphi}}\text{ with } a=\frac{\parth{T_{w}-T_{sat}} \lambda_{w}}{2\rho_{G}h_{lg}\sqrt{\pi\eta_{w}}} \text{ and } 
  b=\begin{cases}
    \frac{T_{sat}-T_{L}}{2 \parth{1-\rho_{G}/\rho_{L} })}, & \text{if $St\leq0.0065$}\\
    \frac{1}{2 \parth{1-\rho_{G}/\rho_{L} })}\frac{\phi_{c,L}+\phi_{e}+\phi_{q}}{0.0065\rho_{L}c_{p,L}\norm{\vect{U_{L}}}}, & \text{\text{if $St>0.0065$}}
  \end{cases}
\end{equation}

where $\lambda_{w}$ and $\eta_{w}$ are the wall thermal conductivity and diffusivity, $St=\displaystyle \frac{\phi_{c,L}+\phi_{e}+\phi_{q}}{\rho_{L}c_{p,L}\norm{\vect{U_{L}}}\parth{T_{sat}-T_{L} }}$ is the Stanton number and $\varphi=\displaystyle \max{1 ; \parth{\frac{\norm{\vect{U_{L}}}}{U_{0}} }^{0.47} }$ with $U_{0}=0.61\text{m/s}$

Finally, the quenching heat flux follows the approach of \textsc{Del Valle} \& \textsc{Kenning}\cite{delvalle1985} supposing that it follows a semi-infinite transient conduction regime : $\displaystyle \phi_{q}=A_{G}t_{q}f\frac{2\lambda_{L} \parth{T_{w}-T_{L}}}{\sqrt{\pi \eta_{L}t_{q}}}$ where $t_{q}$ is the quenching time, supposed to be equal to $1/f$.

\section{Wall Function for Dispersed Boiling Flows}
\label{subsec:wall_func}

In boiling flows, the formation of bubbles at the wall may disturb the liquid velocity profile in the boundary layer. To take this phenomena into account, \textsc{Mimouni} \etal\cite{mimouni2016} proposed a wall function for boiling flows which tends to the single-phase formulation when $\alpha_{G} \rightarrow 0$ and depends on the bubble diameter and density at the wall : 

\begin{equation}
\label{eq:wall_law}
u^{+}=\frac{1}{\kappa}\ln{ y^{+} } + B - \Delta u^{+} \text{ with } 
  \Delta u^{+}=\begin{cases}
    0 & \text{if $k_{r}^{+}\leq11.3$}\\
    \frac{1}{\kappa}\ln{ 1+ C_{kr}k_{r}^{+} } & \text{\text{if $k_{r}^{+}>11.3$}}
  \end{cases}
\end{equation}

where $\kappa$=0.41 is the Von Karman constant, $B=5.3$ the standard single-phase logarithmic law constant. $\Delta u^{+}$ represents the offset of $u^{+}$ due to the wall roughness induced by the presence of bubble. We have $C_{kr}=0.5$ and $k_{r}=\displaystyle \frac{k_{r}\sqrt{u^{*}u_{T}}}{\nu_{L}}$ the "roughness Reynolds number" with $u_{T}=C_{\mu}^{1/4}\sqrt{k_{L}}$ defined from the $k-\varepsilon$ constant $C_{\mu}=0.09$ and $k_{L}$ the liquid turbulent kinetic energy. Finally, $k_{r}=\alpha_{G}d_{G}$.

The non-dimensional wall liquid temperature $T_{L}^{+}$ is modeled according to \textsc{Leduc}\cite{leduc1995}:

\begin{equation}
\label{eq:wall_law} 
  T_{L}^{+}=\begin{cases}
    Pr_{L}~y^{+}, & \text{if $y^{+}\leq 13.2$}\\
    8.67Pr_{L,T}\parth{ \frac{Pr_{L}}{Pr_{L,T}}-1 } \parth{\frac{Pr_{L,T}}{Pr_{L}} }^{0.25} + \frac{Pr_{L,T}}{\kappa}\ln{Ey^{+}}  & \text{\text{if $y^{+}>13.2$}}
  \end{cases}
\end{equation}

With $Pr_{L,T}=0.9$ the turbulent liquid Prandtl number, and $E=7.76$ a constant for smoth walls.